<!DOCTYPE html>
<html lang='en'>
  <!-- Hello dear source reader, feel free to wander around. -->
  <head>
    <!-- I really think you should use https -->
    <script>
      var host = "www.timfelgentreff.de";
      if ((host == window.location.host) && (window.location.protocol != "https:")) window.location.protocol = "https";
    </script>
    <!-- I *love* UTF-8 -->
    <meta charset='utf-8'>
    <meta content='width=device-width,initial-scale=1.0' name='viewport'>
    <title>Linux PM on Macbook Pro - www.timfelgentreff.de</title>
    <script src='/articles.js?Njc1NDBkOQ==' type='text/javascript'></script>
    <script src='/blog.js?Njc1NDBkOQ==' type='text/javascript'></script>
    <link href='//fonts.googleapis.com/css?family=Fanwood+Text' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <link href='/blog.css?Njc1NDBkOQ==' rel='stylesheet' type='text/css'>
    <link href='https://www.timfelgentreff.de' rel='canonical'>
    <link href='//upload.wikimedia.org/wikipedia/commons/a/a8/Cesium.svg' rel='icon' type='image/jpeg'>
    <link href='http://feeds.feedburner.com/blogbithugorg' rel='alternate' title='https://www.timfelgentreff.de' type='application/rss+xml'>
  </head>
  <body class='hyphenate'>
    <!-- IE 9 supports CSS3/HTML5, or at least that's what I'm told. -->
    <!--[if lt IE 9]>
      <script src='http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js' type='text/javascript'></script>
      <div id='prompt'></div>
      <script>
        window.attachEvent("onload", function() { CFInstall.check({ mode: "inline", node: "prompt" })});
      </script>
    <![endif]-->
    <div class='blog'>
      <div class='header'>
        Coding and stuff
        <!-- .subtitle Because, because, because of the wonderful things he does -->
        <nav>
          <a class='link' href='/cv.html' title='CV'>CV</a>
        </nav>
      </div>
      <nav>
        <a class='link first' href='/2010/06/jax.html' title='Git talk @ JaX 2010'>&lt;&lt;</a>
        <a class='link prev' href='/2010/11/rsoc.html' title='Ruby Summer of Code Wrap-Up'>&lt;</a>
        <a class='link next' href='/2011/09/maglev-debug.html' title='Debugging on steroids - what Ru&amp;hellip;'>&gt;</a>
        <a class='link last' href='/2015/09/phd.html' title='PhD Thesis Progress'>&gt;&gt;</a>
      </nav>
      <article data-source='/2010/11/powersaving-on-macbook.html'>
        <header>
          <h1 property='dc:title' xmlns:dc='http://purl.org/dc/elements/1.1/'>Linux PM on Macbook Pro</h1>
          <div class='author'>
            by
            <a href='mailto:timfelgentreff@gmail.com' property='cc:attributionName' xmlns:cc='http://creativecommons.org/ns#'>Tim Felgentreff</a>
            ,
            <time class='timeago' datetime='2010-11-28T00:00:00+00:00' pubdate>2010/11/28, 00:00 UTC</time>
          </div>
        </header>
        <section class='content'>
          
          <p>I have recently switched back to Linux as my main OS on my Macbook Pro (7,1 series). After half a year of using Mac OS X, I found I couldn’t force it to yield to my workflow and preferences in too many ways. I still think it is a great system, and a great user experience, it’s just that I have grown accustomed to so many little kinks (like sloppy-focus) that I find I cannot use Mac OS X as effectively as my customized Linux desktop.</p>
          
          <p>After customizing my environment (which can be done easily using GUI tools on modern desktop linux distributions), I realized I had to tweak a little to get battery life up to par with what it was under Mac OS X.</p>
          
          <p>Much of these steps are drawn from the <a href="https://help.ubuntu.com/community/MacBookPro7-1/Maverick">Ubuntu Wiki</a>.</p>
          
          <p>First, there’s a PPA with Macbook specific daemons, drivers, tools, so I added that and installed a few things from there:</p>
          
          <p><code>  $ sudo add-apt-repository ppa:mactel-support &amp;&amp; sudo apt-get update</code></p>
          
          <p><code>  $ sudo apt-get install pommed macfanctld nvidia-bl-dkms xcalib bcm5974-dkms</code> <code>    xserver-xorg-input-synaptics btusb-dkms</code></p>
          
          <p>This will install:</p>
          
          <ul>
          <li>keyboard backlight support</li>
          
          <li>fan control</li>
          
          <li>screen backlight support</li>
          
          <li>screen color calibration</li>
          
          <li>better touchpad support</li>
          
          <li>bluetooth drivers</li>
          </ul>
          
          <p>After that, a few module tweaks are in order:</p>
          
          <ul>
          <li>
          <p>Activate coretemp on boot<br /><code>  $ sudo su -c &#39;echo coretemp &gt;&gt; /etc/modules&#39;</code></p>
          </li>
          
          <li>
          <p>Activate proper sound driver variant, with powersaving<br /><code>  $ sudo -s</code><br /><code>  # echo &quot;options snd-hda-intel model=mbp55 power_save=1&quot; &gt;&gt; /etc/modprobe.d/alsa-base.conf</code></p>
          </li>
          </ul>
          
          <p>Then, to get reboot working and have usb devices automatically suspend, use this to add a few kernel paramters to <code>/etc/default/grub</code>. Where it reads <code>GRUB_CMDLINE_LINUX_DEFAULT</code>, add:</p>
          
          <p><code>usbcore.autosuspend=1 reboot=pci hpet=force</code><br />To write those changes to the active grub configuration, run:</p>
          
          <p><code>  $ sudo update-grub</code></p>
          
          <p>I found that this did not cause all usb devices be set to auto-suspend, even though they could. So I added a one-liner to /etc/rc.local which I took from <code>powertop</code>:</p>
          
          <p><code>for i in /sys/bus/usb/devices/*/power/control; do echo &quot;auto&quot; &gt; &quot;$i&quot;; done</code><br />Don’t forget to make /etc/rc.local executable with <code>chmod +x /etc/rc.local</code>.</p>
          
          <p>Finally, after installing the proprietary NVidia drivers, you can add the following options to the <code>Device</code> section in <code>/etc/X11/xorg.conf</code>:</p>
          
          <p><code>Option &quot;Coolbits&quot; &quot;1&quot;</code></p>
          
          <p><code>Option &quot;OnDemandVBlankInterrupts&quot; &quot;True&quot;</code></p>
          
          <p><code>Option &quot;RegistryDwords&quot; &quot;PowerMizerEnable=0x1; PerfLevelSrc=0x2233; PowerMizerDefault=0x3&quot;</code></p>
          
          <p>This will activate the frequency override capabilities, enable VBlank interrupts to only fire on demand and set the performance on battery to the fixed-minimum, so that Compiz doesn’t trigger the NVidia performance scaling.</p>
          
          <p>After a reboot with these tweaks, I’m getting between 7.5 and 9.5 Watts usage, which is a little higher than on Mac OS X, but still good enough for around 6h of battery under conservative use (on Wifi, twittering, emailing and surfing).</p>
        </section>
        <br>
        <section class='license'>
          <a rel="cc:attributionURL" href="http://github.com/rkh/rkh.im">This work</a> is licensed under a
          <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/de/deed.en">Creative Commons
          Attribution-ShareAlike 3.0 Germany License</a>. Any source code included is, unless stated otherwise,
          licensed under a <a rel="licenses" href="http://creativecommons.org/licenses/MIT/">MIT License</a>.
          <span class='noprint'>This does not apply for comments (below).</span>
        </section>
        <section class='comments'>
          <!-- I both love and hate disqus -->
        </section>
      </article>
      <aside>
        <p>
          <a href='//feeds.feedburner.com/blogbithugorg' rel='alternate' title='Subscribe to my feed' type='application/rss+xml'>
            <img alt='Subscribe to my feed' src='/public/images/feed-icon.png' width='32px'>
          </a>
        </p>
        <a href='/cv.html' title='CV'>
          <img src='//www.gravatar.com/avatar/36fee2e65c9c0ed678fe3b7d862ed271?s=180'>
        </a>
        
        <p>I received a doctoral degree at the <a href="http://www.hpi.de/swa">Software Architecture Group</a> of the <a href="http://www.hpi.de/">Hasso Plattner Institute</a> at the <a href="http://www.uni-potsdam.de/">University Of Potsdam</a>.</p>
        
        <p>I am now working on programming language and VM related things at Oracle Labs.</p>
        
        <p>You can follow me on <a href="http://twitter.com/timfelgentreff">Twitter</a>. Most of the code I’m talking about is on <a href="http://github.com/timfel">GitHub</a>. I also have a <a href="/cv.html">CV</a>, although I am lazy about updating it.</p>
        <h3>Posts</h3>
        <article>
          <div class='date'>2015/09/25</div>
          <a href='/2015/09/phd.html'>PhD Thesis Progress</a>
        </article>
        <article>
          <div class='date'>2015/04/10</div>
          <a href='/2015/04/rsqueak.html'>RSqueak/VM - A research VM for Squeak/Smalltalk</a>
        </article>
        <article>
          <div class='date'>2012/08/27</div>
          <a href='/2012/08/qoppa.html'>Qoppa - a language to learn about Fexpr's</a>
        </article>
        <article>
          <div class='date'>2012/05/31</div>
          <a href='/2012/05/thesis.html'>Master Thesis Progress</a>
        </article>
        <article>
          <div class='date'>2012/02/22</div>
          <a href='/2012/02/cloud-foundry-squeak.html'>CloudFoundry for Smalltalk applications</a>
        </article>
        <article>
          <div class='date'>2011/09/08</div>
          <a href='/2011/09/maglev-debug.html'>Debugging on steroids - what Ruby should learn from Smalltalk</a>
        </article>
        <article>
          <div class='date'>2010/11/28</div>
          <a href='/2010/11/powersaving-on-macbook.html'>Linux PM on Macbook Pro</a>
        </article>
        <article>
          <div class='date'>2010/11/10</div>
          <a href='/2010/11/rsoc.html'>Ruby Summer of Code Wrap-Up</a>
        </article>
        <article>
          <div class='date'>2010/10/23</div>
          <a href='/2010/10/redcar-syntax-checks.html'>Syntax Checking For Redcar</a>
        </article>
        <article>
          <div class='date'>2010/09/26</div>
          <a href='/2010/09/redcar-debug.html'>A Redcar debugger interface</a>
        </article>
        <article>
          <div class='date'>2010/08/14</div>
          <a href='/2010/08/benchmarking-rdiscount.html'>Benchmarking RDiscount</a>
        </article>
        <article>
          <div class='date'>2010/07/13</div>
          <a href='/2010/07/thin-on-jruby.html'>Thin on JRuby</a>
        </article>
        <article>
          <div class='date'>2010/07/09</div>
          <a href='/2010/07/capi-the-thin-gem-and-not-much-to-show.html'>JRuby commit flag</a>
        </article>
        <article>
          <div class='date'>2010/06/18</div>
          <a href='/2010/06/first-week-of-rubysoc.html'>First week of RubySOC</a>
        </article>
        <article>
          <div class='date'>2010/06/07</div>
          <a href='/2010/06/jax.html'>Git talk @ JaX 2010</a>
        </article>
      </aside>
    </div>
  </body>
</html>
